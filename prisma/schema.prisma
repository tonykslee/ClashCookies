generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model PlayerActivity {
  tag            String   @id
  name           String
  clanTag        String

  lastDonationAt DateTime?
  lastCapitalAt  DateTime?
  lastTrophyAt   DateTime?
  lastWarAt      DateTime?
  lastBuilderAt  DateTime?
  
  lastTrophies          Int?
  lastWarStars          Int?
  lastBuilderTrophies   Int?


  lastSeenAt     DateTime
  updatedAt      DateTime @updatedAt
}

model TrackedClan {
  id        Int      @id @default(autoincrement())
  tag       String   @unique
  name      String?
  createdAt DateTime @default(now())
}

model BotSetting {
  key       String   @id
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model PlayerLink {
  playerTag      String   @id
  discordUserId  String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

enum KickListSource {
  AUTO_INACTIVE
  MANUAL
}

enum RecruitmentPlatform {
  discord
  reddit
  band
}

model KickListEntry {
  id            Int            @id @default(autoincrement())
  guildId       String
  playerTag     String
  playerName    String?
  clanTag       String?
  clanName      String?
  reason        String
  source        KickListSource
  daysThreshold Int?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  @@index([guildId, playerTag])
  @@index([guildId, source])
  @@unique([guildId, playerTag, source])
}

model RecruitmentTemplate {
  id         Int      @id @default(autoincrement())
  clanTag    String
  platform   RecruitmentPlatform
  subject    String?
  requiredTH String
  focus      String
  body       String
  imageUrls  String[]
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([clanTag, platform])
  @@index([clanTag])
}

model RecruitmentCooldown {
  id        Int                 @id @default(autoincrement())
  userId    String
  clanTag   String
  platform  RecruitmentPlatform
  startedAt DateTime
  expiresAt DateTime
  reminded  Boolean             @default(false)
  createdAt DateTime            @default(now())
  updatedAt DateTime            @updatedAt

  @@unique([userId, clanTag, platform])
  @@index([userId, expiresAt])
  @@index([expiresAt, reminded])
}
